# yaml-language-server: schema=https://json.schemastore.org/github-action

name: Workers Deploy

on:
  push:
    branches: [workers]

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3
    - run: corepack enable
    - uses: actions/setup-node@v3
      with:
        cache: pnpm
    - run: pnpm i --frozen-lockfile
    - run: pnpm run test

    - run: printf '\nid = "%s"\n' '${{ secrets.KV_HADA_ID }}' >> wrangler.toml

    - uses: cloudflare/wrangler-action@2.0.0
      with:
        accountId: ${{ secrets.CLOUDFLARE_ACCOUNT_ID }}
        apiToken: ${{ secrets.CLOUDFLARE_API_TOKEN }}
